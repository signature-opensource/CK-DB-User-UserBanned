
create transformer on CK.sAuthUserOnLogin
as
begin
    inject "
    -- Check if user is banned now
    declare @IsBannedNow int = (select IsBannedNow from CK.vUserBanned where UserId = @UserId);
    if (@IsBannedNow is not null and @IsBannedNow > 0)
    begin
        set @FailureCode = 6;
        set @FailureReason = N'LoginFailed.UserBanned';
    end
" after single "--<CheckLoginFailure />"
end
